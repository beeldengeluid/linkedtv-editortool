<div class="modal-header">
	<h4 class="modal-title">Edit/search annotations in: {{dimension.label}}</h4>
</div>

<div class="modal-body">

	<!-- The selected enrichments for this dimension selectedEnrichments-->
	<div class="row">
		<div class="col-md-12">
			<foldable title="Existing enrichments (double click item to remove)" collapsed="savedEnrichmentsCollapsed"></foldable>
			<div collapse="savedEnrichmentsCollapsed">

				<div ng-show="savedEnrichments.length == 0" class="row" ng-show="nothingFound">
					<div class="col-md-12">
						<span class="alert alert-custom">No enrichments were added to this dimension yet</span>
					</div>
				</div>

				<ul ng-show="savedEnrichments.length > 0" class="enrichments">
					<li ng-repeat="e in savedEnrichments track by $index">
						<div class="thumbnail" ng-if="e.url" ng-dblclick="removeEnrichment($index)" title="{{e.description}}">
							<img ng-if="e.poster" ng-src="{{e.poster}}" alt="{{e.label}}">

							<img ng-if="!e.poster" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzEiIGhlaWdodD0iMTgwIj48cmVjdCB3aWR0aD0iMTcxIiBoZWlnaHQ9IjE4MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9Ijg1LjUiIHk9IjkwIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MTcxeDE4MDwvdGV4dD48L3N2Zz4=" alt="Create new chapter">

							<div class="caption">
								<a href="{{e.url}}" target="_external">{{e.label | limitTo:30}}</a>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- display entities -->
	<div class="row">

		<div class="col-md-12">
			<foldable title="Find new enrichments (select entities or enter text to search for them)" collapsed="entitiesCollapsed"></foldable>
			<div collapse="entitiesCollapsed">
				<ul class="nav nav-tabs" role="tablist">
					<li class="active">
						<a data-target="#tab_e_auto" role="tab" data-toggle="tab">Entities mentioned in the program</a>
					</li>
					<li>
						<a data-target="#tab_e_curated" role="tab" data-toggle="tab">Curated enrichments</a>
					</li>
					<li>
						<a data-target="#tab_e_expanded" role="tab" data-toggle="tab">Entities from a broader context</a>
					</li>
				</ul>

				<div class="tab-content">

					<!-- AUTOGENERATED ENTITIES-->
					<div id="tab_e_auto" class="tab-pane active">
						<ul class="entities">
							<li ng-repeat="e in autogeneratedEntities" class="{{entityUtils.getConfidenceClass(e)}}">
								<div ng-click="addQueryEntity(e)"
								class="label label-default entity" title="{{e.label}}">
								{{e.label}}<!-- TODO add the amount again-->
								</div>
							</li>
						</ul>
					</div>

					<!-- CURATED ENRICHMENTS CARDS -->
					<div id="tab_e_curated" class="tab-pane fade">
						<ul class="cards">
							<li ng-repeat="e in combinedEnrichments track by $index" title="{{e.label}}">
								<div class="thumbnail" ng-click="addQueryEntity(e)">

									<img ng-if="!e.poster" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzEiIGhlaWdodD0iMTgwIj48cmVjdCB3aWR0aD0iMTcxIiBoZWlnaHQ9IjE4MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9Ijg1LjUiIHk9IjkwIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MTcxeDE4MDwvdGV4dD48L3N2Zz4=" alt="...">

									<img ng-if="e.poster" ng-src="{{e.poster}}" alt="{{e.label}}">

									<div class="caption">
										<a href="{{e.url}}" target="_external">
											{{e.label | limitTo : 20 || 'No label' | limitTo : 20}}
										</a>
									</div>
								</div>
							</li>
						</ul>
					</div>

					<!-- EXPANDED ENTITIES-->
					<div id="tab_e_expanded" class="tab-pane fade">
						<ul class="entities">
							<li ng-repeat="e in expandedEntities" class="{{entityUtils.getConfidenceClass(e)}}">
								<div ng-click="addQueryEntity(e)"
								class="label label-default entity" title="{{e.label}}">
								{{e.label}}<!-- TODO add the amount again-->
								</div>
							</li>
						</ul>
					</div>

			</div>

			<!-- SEARCH BAR -->
			<div class="row">
				<div class="col-md-12">
					<div class="enrichment-query-items" ng-show="!isEmpty(activeEntities)">
						<label>Selected for enrichment query</label>
						<ul>
							<li ng-repeat="(k, v) in activeEntities" ng-click="removeQueryEntity(k)">
								<div class="label label-default entity">
									{{k}}
									<i class="glyphicon glyphicon-remove"></i>
								</div>
							</li>
						</ul>
					</div>
					<form class="form-inline enrichment-search" role="form">
						<div class="form-group">
							<input id="e_query" type="text">
						</div>
						<button class="btn btn-primary" ng-click="fetchEnrichments()">
							Search
						</button>
					</form>
				</div>
			</div>


		</div>
	</div>
</div>


<div class="row" ng-show="nothingFound">
	<div class="col-md-12">
		<span class="alert alert-custom">No links were found, please try again with different parameters</span>
	</div>
</div>

<!-- The fetched enrichments (make this another template) -->
<div class="row" ng-show="enrichments">

	<div class="col-md-12">
		<foldable title="Found enrichments (double click item to add)" collapsed="enrichmentsCollapsed"></foldable>
		<div collapse="enrichmentsCollapsed">

			<!-- The dropdown for filtering the found enrichments -->
			<div class="row">
				<div class="col-md-12">
					<nav class="tab-menu">
						<ul class="horizontal-menu">
							<li ng-if="activeEnrichmentSource">
								{{activeEnrichmentSource}}
							</li>
							<li>
								<div class="dropdown">
									<button class="btn btn-default dropdown-toggle" type="button" id="menuFilterSource">
										Filter by source
										<span class="caret"></span>
									</button>
									<ul class="dropdown-menu" role="menu" aria-labelledby="menuFilterSource">
										<li role="presentation" ng-repeat="s in enrichmentSources">
											<a role="menuitem" tabindex="-1" ng-click="filterEnrichmentsBySource(s)">{{s}}</a>
										</li>

										<li role="presentation" class="divider"></li>

										<li role="presentation" ng-repeat="es in enrichmentEntitySources">
											<a role="menuitem" tabindex="-1" ng-click="filterEnrichmentsByEntitySource(es)">{{es}}</a>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</nav>
				</div>
			</div>


			<!-- The found enrichments (filtered by the currently selected filter) -->
			<div class="row" ng-show="enrichments">
				<div class="col-md-12">
					<ul class="enrichments">
						<li ng-repeat="e in enrichments">
							<div class="thumbnail" ng-if="e.url" ng-dblclick="addEnrichment(e)"
								title="{{e.description}} - creator: {{e.creator}}">
								{{e.date}}
								<img ng-if="e.poster" ng-src="{{e.poster}}" alt="{{e.label}}">

								<img ng-if="!e.poster" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzEiIGhlaWdodD0iMTgwIj48cmVjdCB3aWR0aD0iMTcxIiBoZWlnaHQ9IjE4MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9Ijg1LjUiIHk9IjkwIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MTcxeDE4MDwvdGV4dD48L3N2Zz4=" alt="{{e.label}}">

								<div class="caption">
									<a href="{{e.url}}" target="_external">
										{{e.label | limitTo:28}}
									</a>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>

		</div>
	</div>
</div>

</div>

<div class="modal-footer">
	<button class="btn btn-primary" ng-click="ok()">Save</button>
	<button class="btn btn-warning" ng-click="cancel()">Cancel</button>
</div>
